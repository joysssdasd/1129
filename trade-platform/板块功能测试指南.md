# 板块功能测试指南

## 📋 测试概览

本次更新添加了交易板块分类功能，需要全面测试以下内容：

### ✅ 已完成的开发工作

1. **数据库改造**
   - ✅ 创建 categories 表
   - ✅ posts 表添加 category_id 字段
   - ✅ 创建触发器自动更新板块统计
   - ✅ 添加数据保护逻辑（删除板块时迁移数据）

2. **前端组件**
   - ✅ CategoryCards - 首页板块卡片展示
   - ✅ CategoryManagement - 管理后台板块管理
   - ✅ CategoryDetailPage - 板块详情页
   - ✅ 修改 PublishPage - 添加板块选择
   - ✅ 修改 HomePage - 集成板块卡片
   - ✅ 修改 AdminPage - 添加板块管理标签

3. **后端功能**
   - ✅ publish-post Edge Function 支持 category_id
   - ✅ RLS 策略配置
   - ✅ 数据完整性保护

---

## 🧪 测试用例

### 1. 数据库测试

#### 1.1 板块表基础功能
```sql
-- 查看默认板块
SELECT * FROM categories ORDER BY sort_order;

-- 应该看到6个默认板块：
-- 数码电子、家居生活、服饰鞋包、图书教育、娱乐休闲、其他分类
```

#### 1.2 触发器测试
```sql
-- 发布一条交易信息到"数码电子"板块
-- 然后查看板块统计是否自动更新
SELECT name, post_count FROM categories WHERE name = '数码电子';
```

#### 1.3 数据保护测试
```sql
-- 尝试删除"其他分类"板块（应该失败）
DELETE FROM categories WHERE name = '其他分类';

-- 删除其他板块，检查数据是否迁移到"其他分类"
-- 1. 先创建测试板块
INSERT INTO categories (name, icon, description, sort_order) 
VALUES ('测试板块', '🧪', '用于测试', 100);

-- 2. 发布交易信息到测试板块
-- 3. 删除测试板块
-- 4. 检查交易信息是否自动移至"其他分类"
```

---

### 2. 管理后台测试

#### 2.1 板块管理界面
- [ ] 登录管理员账号
- [ ] 进入"板块管理"标签
- [ ] 查看是否显示6个默认板块
- [ ] 检查板块信息是否完整（名称、图标、描述、统计数据）

#### 2.2 添加板块
- [ ] 点击"添加板块"按钮
- [ ] 填写板块信息：
  - 名称：美妆个护
  - 图标：💄
  - 描述：化妆品、护肤品、个人护理等
- [ ] 保存后检查是否成功添加
- [ ] 刷新页面，检查板块是否持久化

#### 2.3 编辑板块
- [ ] 点击某个板块的"编辑"按钮
- [ ] 修改板块名称或描述
- [ ] 保存后检查是否更新成功
- [ ] 尝试编辑"其他分类"（应该可以编辑描述，但不建议改名称）

#### 2.4 禁用/启用板块
- [ ] 点击板块的"已启用"按钮
- [ ] 检查板块状态是否变为"已禁用"
- [ ] 前往首页，检查该板块是否不再显示
- [ ] 返回管理后台，重新启用板块
- [ ] 前往首页，检查板块是否重新显示

#### 2.5 删除板块
- [ ] 尝试删除"其他分类"（应该提示不能删除）
- [ ] 删除其他板块
- [ ] 确认删除提示信息是否清晰
- [ ] 检查该板块下的交易信息是否移至"其他分类"
- [ ] 检查"其他分类"的 post_count 是否增加

---

### 3. 首页板块卡片测试

#### 3.1 板块展示
- [ ] 访问首页
- [ ] 检查是否显示板块卡片区域
- [ ] 检查板块数量（应该是启用的板块数量）
- [ ] 检查板块卡片布局（移动端2列，桌面端也是2列）

#### 3.2 板块信息
- [ ] 检查每个板块卡片是否显示：
  - 图标
  - 名称
  - 描述
  - 交易信息数量
  - 查看次数
  - 热度指示器（火焰图标）
  - 热度分数

#### 3.3 热度计算
- [ ] 检查热度分数是否合理
- [ ] 检查热度颜色是否正确：
  - 红色：超级热门（>80分）
  - 橙色：很热门（60-80分）
  - 黄色：较热门（40-60分）
  - 绿色：一般（20-40分）
  - 蓝色：冷门（<20分）

#### 3.4 点击交互
- [ ] 点击板块卡片
- [ ] 检查是否跳转到板块详情页
- [ ] 检查URL是否正确（/category/:categoryId）

---

### 4. 板块详情页测试

#### 4.1 页面基础
- [ ] 检查页面标题是否显示板块名称
- [ ] 检查是否显示交易信息数量
- [ ] 检查返回按钮是否正常工作

#### 4.2 搜索功能
- [ ] 在搜索框输入关键词
- [ ] 检查是否只搜索当前板块的交易信息
- [ ] 检查搜索结果是否准确

#### 4.3 交易信息列表
- [ ] 检查是否只显示该板块的交易信息
- [ ] 检查交易信息卡片显示是否正常
- [ ] 检查"交易"按钮是否正常工作
- [ ] 点击交易信息，检查是否跳转到详情页

#### 4.4 空状态
- [ ] 访问一个没有交易信息的板块
- [ ] 检查是否显示"该板块暂无交易信息"
- [ ] 检查"发布第一条信息"按钮是否正常工作

---

### 5. 发布页面测试

#### 5.1 板块选择器
- [ ] 进入发布页面
- [ ] 检查是否显示"选择板块（可选）"下拉框
- [ ] 检查下拉框是否列出所有启用的板块
- [ ] 检查每个选项是否显示图标和名称

#### 5.2 默认选择
- [ ] 检查默认是否选择"其他分类"
- [ ] 修改选择其他板块
- [ ] 检查选择是否生效

#### 5.3 发布测试
- [ ] 填写完整的交易信息
- [ ] 选择一个板块（如"数码电子"）
- [ ] 点击发布
- [ ] 检查是否发布成功
- [ ] 前往该板块详情页，检查是否显示刚发布的信息
- [ ] 检查板块的 post_count 是否增加

#### 5.4 不选择板块
- [ ] 发布时不选择板块（保持默认"其他分类"）
- [ ] 检查是否发布成功
- [ ] 检查交易信息是否出现在"其他分类"板块

---

### 6. 边界情况测试

#### 6.1 板块数量限制
- [ ] 添加板块直到总数超过6个
- [ ] 检查首页显示是否正常
- [ ] 检查移动端布局是否对齐
- [ ] 建议：保持4或6个板块（双数）

#### 6.2 数据一致性
- [ ] 删除一个有交易信息的板块
- [ ] 检查所有交易信息是否正确迁移
- [ ] 检查"其他分类"的统计数据是否正确
- [ ] 检查没有遗留的孤立数据

#### 6.3 权限测试
- [ ] 普通用户访问管理后台（应该无法访问）
- [ ] 普通用户尝试直接调用板块管理API（应该失败）
- [ ] 游客查看板块卡片（应该可以查看）
- [ ] 游客点击板块详情（应该可以查看）

#### 6.4 性能测试
- [ ] 板块数量较多时（8-10个）首页加载速度
- [ ] 板块详情页有大量交易信息时的加载速度
- [ ] 板块统计数据更新的响应速度

---

### 7. 移动端测试

#### 7.1 响应式布局
- [ ] 在手机上访问首页
- [ ] 检查板块卡片是否2列显示
- [ ] 检查卡片大小是否合适
- [ ] 检查文字是否清晰可读

#### 7.2 触摸交互
- [ ] 点击板块卡片是否响应灵敏
- [ ] 滚动是否流畅
- [ ] 下拉刷新是否正常工作

#### 7.3 板块详情页
- [ ] 检查板块详情页在移动端的显示
- [ ] 检查搜索框是否好用
- [ ] 检查交易信息列表是否正常

---

### 8. 回归测试

#### 8.1 原有功能
- [ ] 用户注册登录是否正常
- [ ] 发布交易信息是否正常（不选板块）
- [ ] 查看交易详情是否正常
- [ ] 查看联系方式是否正常
- [ ] 积分系统是否正常
- [ ] 充值功能是否正常

#### 8.2 管理后台
- [ ] 用户管理是否正常
- [ ] 信息管理是否正常
- [ ] 充值审核是否正常
- [ ] AI批量发布是否正常
- [ ] 数据分析是否正常

---

## 🐛 已知问题和注意事项

### 1. 数据迁移
- 删除板块时，该板块下的所有交易信息会自动移至"其他分类"
- 这个过程是不可逆的，请谨慎操作

### 2. 板块数量建议
- 建议保持4或6个板块（双数）
- 移动端显示更美观，布局更对齐

### 3. "其他分类"板块
- 不能删除
- 用于存放未分类或被迁移的交易信息
- 可以编辑描述，但不建议改名称

### 4. 热度计算
- 热度分数基于：交易数量、查看次数、成交次数
- 每次加载板块时实时计算
- 可能需要一定数据积累才能看到明显差异

---

## 📊 测试报告模板

### 测试环境
- 浏览器：
- 设备：
- 测试时间：
- 测试人：

### 测试结果
| 测试项 | 状态 | 备注 |
|-------|------|------|
| 数据库基础功能 | ⬜ 通过 / ⬜ 失败 | |
| 管理后台-添加板块 | ⬜ 通过 / ⬜ 失败 | |
| 管理后台-编辑板块 | ⬜ 通过 / ⬜ 失败 | |
| 管理后台-删除板块 | ⬜ 通过 / ⬜ 失败 | |
| 首页板块卡片展示 | ⬜ 通过 / ⬜ 失败 | |
| 板块详情页 | ⬜ 通过 / ⬜ 失败 | |
| 发布页面板块选择 | ⬜ 通过 / ⬜ 失败 | |
| 数据保护逻辑 | ⬜ 通过 / ⬜ 失败 | |
| 移动端适配 | ⬜ 通过 / ⬜ 失败 | |
| 回归测试 | ⬜ 通过 / ⬜ 失败 | |

### 发现的问题
1. 
2. 
3. 

### 建议和改进
1. 
2. 
3. 

---

## ✅ 测试完成标准

- [ ] 所有测试用例通过率 ≥ 95%
- [ ] 无P0/P1级别Bug
- [ ] 数据完整性验证通过
- [ ] 移动端和桌面端都测试通过
- [ ] 性能指标达标
- [ ] 回归测试全部通过

---

**测试完成后，请将测试报告发送给开发团队！** 🎉
