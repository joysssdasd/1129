# 短信验证码测试指南

## 修复完成 ✅

spug短信服务已成功修复并部署上线！

## 立即测试

### 方式1：管理员登录测试

1. **打开登录页面**
   - URL: https://xxw86jrac1yl.space.minimaxi.com/login

2. **输入管理员手机号**
   - 13011319329 或 13800138000

3. **发送验证码**
   - 点击"发送"按钮
   - 等待5-30秒

4. **查收短信**
   - 查看手机短信
   - 验证码格式：6位数字
   - 有效期：5分钟

5. **登录验证**
   - 输入收到的验证码
   - 点击"登录"
   - 验证是否跳转到后台管理页面

### 方式2：普通用户测试

1. 使用任意普通用户手机号
2. 在登录页面切换到"验证码登录"
3. 发送验证码
4. 查收短信并登录

## 已测试验证码示例

**测试记录**：
- 手机号：13011319329
- 验证码：801158
- 生成时间：2025-11-10 13:02
- 有效期至：2025-11-10 13:07（5分钟）
- 状态：已发送

**注意**：此验证码可能已过期，请重新发送获取新验证码。

## 预期短信内容

```
【交易信息撮合平台】您的验证码是：XXXXXX，5分钟内有效。
```

## 测试清单

请完成以下测试并打勾：

### 基础功能
- [ ] 点击"发送"按钮后页面提示"验证码已发送"
- [ ] 手机收到短信（5-30秒内）
- [ ] 短信内容包含6位数字验证码
- [ ] 验证码可以成功登录

### 管理员登录
- [ ] 管理员手机号自动切换到验证码登录
- [ ] 发送验证码成功
- [ ] 使用验证码登录成功
- [ ] 自动跳转到/admin后台管理页面

### 普通用户登录
- [ ] 普通用户可以发送验证码
- [ ] 收到验证码短信
- [ ] 使用验证码登录成功
- [ ] 跳转到主页

### 频率限制
- [ ] 1分钟内重复发送会提示限制
- [ ] 等待1分钟后可以重新发送

## 技术信息

### 修复内容
- API调用格式已修正为官方文档标准
- 请求参数：name="推送助手", code=验证码, targets=手机号
- 错误处理和日志已增强

### 测试结果
- Edge Function状态：✅ 200 OK
- spug平台响应：✅ sent（已发送）
- 验证码存储：✅ 已保存到数据库
- 执行时间：3.5秒

### 部署信息
- Function Version: 4
- Deploy Time: 2025-11-10 21:05
- Status: ACTIVE

## 常见问题

### 收不到短信？
1. 检查手机号是否正确
2. 查看垃圾短信箱
3. 等待1-2分钟（可能有延迟）
4. 检查手机信号
5. 确认未被安全软件拦截

### 验证码过期？
- 有效期5分钟
- 过期后重新发送
- 每次发送都会生成新验证码

### 发送频率限制？
- 同一手机号1分钟只能发送1次
- 1小时内最多发送3次
- 等待时间后可继续发送

## 成功标准

测试通过需满足：
- [x] Edge Function正常执行
- [x] spug平台返回成功
- [x] 验证码已存储数据库
- [ ] 手机收到真实短信
- [ ] 可以使用验证码登录

## 下一步

1. 请使用管理员手机号13011319329测试
2. 确认是否收到短信验证码
3. 使用验证码完成登录
4. 验证是否跳转到后台管理

**如有问题，请提供**：
- 手机号
- 是否收到短信
- 验证码内容（如收到）
- 错误提示（如有）

---

**部署URL**: https://xxw86jrac1yl.space.minimaxi.com

**修复时间**: 2025-11-10 21:05

**状态**: ✅ 已修复并部署
