# 上传收款二维码指南

## 🎯 目标
上传微信和支付宝收款二维码到 Supabase Storage，让充值页面能够显示。

---

## 📋 准备工作

### 1. 准备二维码图片

确保你有以下两张图片：
- 微信收款二维码（建议命名为 `wechat-qr.jpg`）
- 支付宝收款二维码（建议命名为 `alipay-qr.jpg`）

**图片要求**:
- 格式: JPG, PNG, JPEG
- 大小: < 5 MB
- 清晰度: 建议至少 500x500 像素
- 内容: 确保二维码清晰可扫

---

## 🚀 上传步骤

### 方式一：通过 Supabase Dashboard 上传（推荐）

#### 步骤 1: 打开 Storage

1. 访问 [Supabase Dashboard](https://supabase.com/dashboard/project/hntiihuxqlklpiyqmlob)
2. 左侧菜单点击 **Storage**
3. 找到并点击 `payment-qrcodes` bucket

或直接访问: https://supabase.com/dashboard/project/hntiihuxqlklpiyqmlob/storage/buckets/payment-qrcodes

#### 步骤 2: 上传微信收款二维码

1. 点击右上角 **Upload file** 按钮
2. 选择你的微信收款二维码图片
3. 在文件名输入框中输入: `wechat-qr.jpg`
4. 点击 **Upload**

#### 步骤 3: 上传支付宝收款二维码

1. 再次点击 **Upload file** 按钮
2. 选择你的支付宝收款二维码图片
3. 在文件名输入框中输入: `alipay-qr.jpg`
4. 点击 **Upload**

#### 步骤 4: 验证上传

上传后，你应该看到两个文件：
- ✅ `wechat-qr.jpg`
- ✅ `alipay-qr.jpg`

点击文件名可以预览图片，确保二维码清晰可见。

---

### 方式二：通过 Supabase CLI 上传

如果你更喜欢命令行：

```bash
# 确保已登录
npx supabase login

# 链接项目
npx supabase link --project-ref hntiihuxqlklpiyqmlob

# 上传微信收款二维码
npx supabase storage upload payment-qrcodes/wechat-qr.jpg ./path/to/your/wechat-qr.jpg

# 上传支付宝收款二维码
npx supabase storage upload payment-qrcodes/alipay-qr.jpg ./path/to/your/alipay-qr.jpg
```

---

## ✅ 验证上传成功

### 方法 1: 在 Dashboard 中查看

1. 打开 [Storage - payment-qrcodes](https://supabase.com/dashboard/project/hntiihuxqlklpiyqmlob/storage/buckets/payment-qrcodes)
2. 确认看到两个文件
3. 点击文件名预览图片

### 方法 2: 通过 URL 访问

上传成功后，你的二维码 URL 应该是：

**微信收款二维码**:
```
https://hntiihuxqlklpiyqmlob.supabase.co/storage/v1/object/public/payment-qrcodes/wechat-qr.jpg
```

**支付宝收款二维码**:
```
https://hntiihuxqlklpiyqmlob.supabase.co/storage/v1/object/public/payment-qrcodes/alipay-qr.jpg
```

在浏览器中打开这些 URL，应该能看到你的二维码图片。

### 方法 3: 在小程序中测试

1. 打开微信开发者工具
2. 编译并运行小程序
3. 进入"充值"页面
4. 检查是否显示两个收款二维码
5. 点击二维码应该能放大查看

---

## 🔧 常见问题

### Q1: 上传后看不到图片

**可能原因**:
1. Bucket 不是 Public
2. 文件名不匹配
3. 浏览器缓存

**解决方案**:
```sql
-- 检查 bucket 是否 public
SELECT id, name, public FROM storage.buckets WHERE id = 'payment-qrcodes';

-- 如果不是 public，执行：
UPDATE storage.buckets SET public = true WHERE id = 'payment-qrcodes';
```

### Q2: 小程序中显示"暂无"

**可能原因**:
1. 数据库中的 URL 不正确
2. 文件名不匹配

**解决方案**:
```sql
-- 检查数据库中的 URL
SELECT payment_type, qr_code_url, status FROM payment_qrcodes;

-- 如果 URL 不对，更新：
UPDATE payment_qrcodes 
SET qr_code_url = 'https://hntiihuxqlklpiyqmlob.supabase.co/storage/v1/object/public/payment-qrcodes/wechat-qr.jpg'
WHERE payment_type = 'wechat';

UPDATE payment_qrcodes 
SET qr_code_url = 'https://hntiihuxqlklpiyqmlob.supabase.co/storage/v1/object/public/payment-qrcodes/alipay-qr.jpg'
WHERE payment_type = 'alipay';
```

### Q3: 上传失败

**可能原因**:
1. 文件太大（> 5 MB）
2. 文件格式不支持
3. 权限问题

**解决方案**:
1. 压缩图片到 < 5 MB
2. 转换为 JPG 或 PNG 格式
3. 检查 Supabase 账号权限

### Q4: 想更换二维码

**解决方案**:
1. 在 Storage 中删除旧文件
2. 上传新文件（使用相同的文件名）
3. 或者上传新文件后更新数据库 URL

---

## 📱 测试充值功能

上传完成后，测试充值功能：

1. **打开小程序**
   - 登录账号
   - 进入"充值"页面

2. **检查二维码显示**
   - ✅ 微信收款二维码显示
   - ✅ 支付宝收款二维码显示
   - ✅ 点击可以放大查看

3. **测试充值流程**
   - 选择充值金额
   - 扫码付款
   - 截图付款记录
   - 上传截图
   - 提交充值申请

4. **验证提交成功**
   - 提示"充值申请已提交"
   - 在数据库中查看记录：
   ```sql
   SELECT * FROM recharge_requests ORDER BY created_at DESC LIMIT 5;
   ```

---

## 🎉 完成！

上传完成后：
- ✅ 充值页面能显示收款二维码
- ✅ 用户可以扫码付款
- ✅ 用户可以上传付款截图
- ✅ 管理员可以审核充值申请

---

## 📞 需要帮助？

如果遇到问题：
1. 检查 `数据库配置完成报告.md`
2. 查看 `问题修复总结.md`
3. 检查 Supabase Dashboard 日志
4. 查看微信开发者工具控制台

---

**祝你上传顺利！🚀**
