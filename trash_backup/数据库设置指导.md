# Supabase æ•°æ®åº“è®¾ç½®æŒ‡å¯¼

## ğŸ¯ ç›®æ ‡
åˆ›å»º `payment_qrcodes` è¡¨ï¼ˆæ”¶æ¬¾äºŒç»´ç è¡¨ï¼‰å’Œ `recharge_requests` è¡¨ï¼ˆå……å€¼è¯·æ±‚è¡¨ï¼‰ï¼Œå¹¶æ’å…¥é»˜è®¤çš„æ”¯ä»˜äºŒç»´ç æ•°æ®ã€‚

## ğŸ“‹ éœ€è¦æ‰§è¡Œçš„æ•°æ®åº“æ“ä½œ

### 1. è®¿é—® Supabase Dashboard
- URL: https://supabase.com/dashboard/project/qxqbqllpdbjpheynezh/sql
- ç™»å½•ä½ çš„ Supabase è´¦æˆ·

### 2. æ‰§è¡Œæ•°æ®åº“è®¾ç½®è„šæœ¬
1. åœ¨ SQL ç¼–è¾‘å™¨ä¸­ï¼Œå¤åˆ¶å¹¶ç²˜è´´ä»¥ä¸‹å®Œæ•´è„šæœ¬å†…å®¹ï¼š
2. ç‚¹å‡» "Run" æŒ‰é’®æ‰§è¡Œè„šæœ¬
3. ç­‰å¾…æ‰§è¡Œå®Œæˆ

**å®Œæ•´ SQL è„šæœ¬ä½ç½®**: `E:\claude15\trade-platform\database-setup-complete.sql`

### 3. éªŒè¯è¡¨åˆ›å»º
æ‰§è¡Œå®Œè„šæœ¬åï¼Œæ£€æŸ¥ä»¥ä¸‹å†…å®¹ï¼š

#### âœ… è¡¨ç»“æ„éªŒè¯
- `payment_qrcodes` è¡¨åº”è¯¥åŒ…å«ï¼š
  - `id`: UUID ä¸»é”®
  - `payment_type`: 'wechat' æˆ– 'alipay'
  - `qr_code_url`: æ”¶æ¬¾äºŒç»´ç é“¾æ¥
  - `status`: 'active' çŠ¶æ€
  - `created_at`, `updated_at`: æ—¶é—´æˆ³

- `recharge_requests` è¡¨åº”è¯¥åŒ…å«ï¼š
  - `id`: UUID ä¸»é”®
  - `user_id`: ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
  - `amount`: å……å€¼é‡‘é¢
  - `points`: å……å€¼ç§¯åˆ†
  - `payment_method`: æ”¯ä»˜æ–¹å¼
  - `status`: å¤„ç†çŠ¶æ€

- `point_transactions` è¡¨åº”è¯¥åŒ…å«ï¼š
  - `id`: UUID ä¸»é”®
  - `user_id`: ç”¨æˆ·IDï¼ˆå¤–é”®ï¼‰
  - `change_amount`: ç§¯åˆ†å˜åŒ–é‡
  - `description`: æè¿°
  - `created_at`: åˆ›å»ºæ—¶é—´

#### âœ… æ•°æ®éªŒè¯
- `payment_qrcodes` è¡¨åº”è¯¥åŒ…å«ä¸¤æ¡è®°å½•ï¼š
  - `wechat`: å¾®ä¿¡æ”¶æ¬¾äºŒç»´ç 
  - `alipay`: æ”¯ä»˜å®æ”¶æ¬¾äºŒç»´ç 

## ğŸ”§ æ‰‹åŠ¨æ‰§è¡Œæ­¥éª¤

### æ­¥éª¤ 1: æ‰“å¼€ SQL ç¼–è¾‘å™¨
```
https://supabase.com/dashboard/project/qxqbqllpdbjpheynezh/sql
```

### æ­¥éª¤ 2: å¤åˆ¶ SQL è„šæœ¬
æ‰“å¼€ `E:\claude15\trade-platform\database-setup-complete.sql` æ–‡ä»¶ï¼Œå¤åˆ¶å…¨éƒ¨å†…å®¹

### æ­¥éª¤ 3: ç²˜è´´å¹¶æ‰§è¡Œ
å°†å†…å®¹ç²˜è´´åˆ° SQL ç¼–è¾‘å™¨ä¸­ï¼Œç‚¹å‡» "Run"

### æ­¥éª¤ 4: éªŒè¯ç»“æœ
æ‰§è¡Œå®Œæˆåï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
=== payment_qrcodes è¡¨æ•°æ®éªŒè¯ ===
payment_type  | status | qr_code_url_preview
wechat        | active | https://api.qrserver.com/v1/create-qr-code/...
alipay        | active | https://api.qrserver.com/v1/create-qr-code/...

=== è¡¨ç»“æ„éªŒè¯ ===
table_name         | column_name    | data_type
payment_qrcodes    | id             | uuid
payment_qrcodes    | payment_type   | character varying
...                | ...            | ...

ğŸ‰ æ•°æ®åº“è®¾ç½®å®Œæˆï¼
```

## ğŸ§ª éªŒè¯è„šæœ¬

è¿è¡ŒéªŒè¯è„šæœ¬æ¥æ£€æŸ¥è®¾ç½®æ˜¯å¦æˆåŠŸï¼š
```bash
cd "E:\claude15\trade-platform"
node verify-database.js
```

æœŸæœ›çœ‹åˆ°ï¼š
```
âœ… payment_qrcodes è¡¨å­˜åœ¨ä¸”å¯è®¿é—®
âœ… recharge_requests è¡¨å­˜åœ¨ä¸”å¯è®¿é—®
âœ… point_transactions è¡¨å­˜åœ¨ä¸”å¯è®¿é—®
ğŸŒŸ æ‰€æœ‰è¡¨åˆ›å»ºæˆåŠŸï¼Œæ•°æ®å®Œæ•´ï¼
```

## ğŸŒ å‰ç«¯é›†æˆ

æ•°æ®åº“è®¾ç½®å®Œæˆåï¼Œå‰ç«¯å°†èƒ½å¤Ÿï¼š

1. **æ˜¾ç¤ºæ”¶æ¬¾äºŒç»´ç **
   - è®¿é—®: `http://localhost:5173/profile`
   - åœ¨å……å€¼é¡µé¢æ˜¾ç¤ºå¾®ä¿¡å’Œæ”¯ä»˜å®äºŒç»´ç 

2. **å¤„ç†å……å€¼è¯·æ±‚**
   - ç”¨æˆ·ä¸Šä¼ å……å€¼æˆªå›¾
   - ç®¡ç†å‘˜å®¡æ ¸å……å€¼è¯·æ±‚
   - è‡ªåŠ¨å¢åŠ ç”¨æˆ·ç§¯åˆ†

3. **è®°å½•ç§¯åˆ†äº¤æ˜“**
   - æ¯æ¬¡ç§¯åˆ†å˜åŒ–éƒ½æœ‰è®°å½•
   - æ”¯æŒæŸ¥è¯¢å†å²äº¤æ˜“

## ğŸ“Š æ•°æ®åº“è¡¨è¯¦ç»†ç»“æ„

### payment_qrcodes (æ”¶æ¬¾äºŒç»´ç è¡¨)
```sql
CREATE TABLE public.payment_qrcodes (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    payment_type VARCHAR(20) NOT NULL CHECK (payment_type IN ('wechat', 'alipay')),
    qr_code_url TEXT NOT NULL,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(payment_type)
);
```

### recharge_requests (å……å€¼è¯·æ±‚è¡¨)
```sql
CREATE TABLE public.recharge_requests (
    id UUID DEFAULT uuid_generate_v4() PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    amount DECIMAL(10,2) NOT NULL,
    points INTEGER NOT NULL,
    payment_method VARCHAR(20) NOT NULL CHECK (payment_method IN ('wechat', 'alipay')),
    status INTEGER DEFAULT 0 CHECK (status IN (0, 1, 2)),
    screenshot_url TEXT,
    is_custom BOOLEAN DEFAULT FALSE,
    admin_id UUID REFERENCES auth.users(id),
    admin_note TEXT,
    processed_at TIMESTAMPTZ,
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜ 1: SQL æ‰§è¡Œå¤±è´¥
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤æœ‰è¶³å¤Ÿçš„æƒé™
- æ£€æŸ¥ SQL è¯­æ³•

### é—®é¢˜ 2: è¡¨åˆ›å»ºæˆåŠŸä½†æ•°æ®æœªæ’å…¥
- æ£€æŸ¥ `INSERT` è¯­å¥æ˜¯å¦æ‰§è¡Œ
- ç¡®è®¤æ²¡æœ‰è¿åçº¦æŸæ¡ä»¶
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—

### é—®é¢˜ 3: å‰ç«¯æ— æ³•è®¿é—®æ•°æ®
- æ£€æŸ¥ RLS (Row Level Security) ç­–ç•¥
- ç¡®è®¤è¡¨æƒé™è®¾ç½®æ­£ç¡®
- éªŒè¯ API å¯†é’¥é…ç½®

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥ Supabase Dashboard çš„é”™è¯¯æ—¥å¿—
2. è¿è¡ŒéªŒè¯è„šæœ¬æ£€æŸ¥è¡¨çŠ¶æ€
3. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
4. ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

## âœ… å®Œæˆæ ‡å‡†

è®¾ç½®æˆåŠŸçš„æ ‡å‡†ï¼š
- [ ] `payment_qrcodes` è¡¨å­˜åœ¨ä¸”æœ‰ä¸¤æ¡è®°å½•
- [ ] `recharge_requests` è¡¨å­˜åœ¨
- [ ] `point_transactions` è¡¨å­˜åœ¨
- [ ] æ‰€æœ‰ç´¢å¼•å’Œè§¦å‘å™¨åˆ›å»ºæˆåŠŸ
- [ ] éªŒè¯è„šæœ¬æ˜¾ç¤ºæˆåŠŸ
- [ ] å‰ç«¯å¯ä»¥æ­£å¸¸æ˜¾ç¤ºæ”¶æ¬¾äºŒç»´ç 