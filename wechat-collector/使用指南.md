# 微信群消息自动采集工具 - 使用指南

## 功能说明

自动从微信群采集交易信息，通过AI解析后发布到交易平台。

## 快速开始

### 方式一：剪贴板监控模式（推荐）

1. 双击运行 `启动采集工具.bat`
2. 选择 `1. 剪贴板监控模式`
3. 在微信中复制交易消息
4. 工具会自动检测并采集
5. 每60分钟自动处理并发布

```bash
# 或命令行运行
python auto_collect_enhanced.py --mode clipboard --interval 60
```

### 方式二：文件监控模式

1. 运行 `启动采集工具.bat`
2. 选择 `2. 文件监控模式`
3. 将交易信息保存为 `.txt` 文件到监控目录
4. 工具会自动扫描并处理

```bash
python auto_collect_enhanced.py --mode file --watch-dir ./messages --interval 60
```

### 方式三：数据库直读模式（需要密钥）

1. 运行 `启动采集工具.bat` 选择 `3. 获取密钥`
2. 或运行 `python setup_and_decrypt.py`
3. 获取密钥后运行 `python main.py`

## 配置说明

编辑 `config.json`:

```json
{
  "wechat": {
    "data_path": "E:\\xwechat_files",  // 微信数据目录
    "wxid": "wxid_xxx",                 // 你的微信ID
    "db_key": ""                        // 数据库密钥（可选）
  },
  "monitor_groups": [
    "群名称1",
    "群名称2"
  ],
  "platform": {
    "supabase_url": "https://xxx.supabase.co",
    "supabase_anon_key": "xxx",
    "user_id": "xxx",                   // 你的用户ID
    "default_wechat_id": "niuniubase"   // 默认联系微信
  },
  "schedule": {
    "interval_minutes": 60,             // 处理间隔（分钟）
    "start_hour": 8,                    // 开始时间
    "end_hour": 23                      // 结束时间
  },
  "ai": {
    "deepseek_api_key": "sk-xxx",       // DeepSeek API密钥
    "model": "deepseek-chat"
  },
  "filter": {
    "keywords": ["出", "收", "转", "票"],  // 过滤关键词
    "min_message_length": 10,
    "max_message_length": 2000
  }
}
```

## 依赖安装

```bash
pip install httpx loguru pyperclip
# 如需数据库模式
pip install pywxdump pycryptodome
```

## 常见问题

**Q: 剪贴板模式没反应？**
A: 确保消息包含配置的关键词，且长度在10-2000字符之间

**Q: 发布失败？**
A: 检查 config.json 中的 supabase_url、supabase_anon_key、user_id 是否正确

**Q: 如何获取数据库密钥？**
A: 运行 `python setup_and_decrypt.py`，需要微信已登录且以管理员权限运行
