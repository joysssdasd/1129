# 🚀 立即部署指南 - 板块功能

## ⚡ 快速部署（3步完成）

---

## 第1步：部署 Edge Function（5分钟）

### 方式A：使用 Supabase CLI（推荐）

```bash
# 1. 进入 functions 目录
cd supabase/functions

# 2. 部署 publish-post 函数
supabase functions deploy publish-post

# 3. 验证部署
supabase functions list
```

### 方式B：使用 Supabase 控制台

1. 访问：https://supabase.com/dashboard/project/mgyelmyjeidlvmmmjkqi
2. 点击左侧菜单 "Edge Functions"
3. 找到 "publish-post" 函数
4. 点击 "Deploy" 或 "Update"
5. 上传 `supabase/functions/publish-post/index.ts` 文件
6. 等待部署完成

---

## 第2步：部署前端（10分钟）

### 方式A：通过 EdgeOne Pages 控制台（推荐）

1. **登录控制台**
   - 访问：https://console.cloud.tencent.com/edgeone
   - 登录您的腾讯云账号

2. **选择项目**
   - 找到项目：www.niuniubase.top
   - 点击进入项目详情

3. **上传文件**
   - 点击"部署"或"上传"按钮
   - 选择 `trade-platform/dist/` 文件夹
   - 或者压缩 dist 文件夹后上传 zip

4. **等待部署**
   - 等待1-3分钟
   - 查看部署日志
   - 确认部署成功

5. **刷新缓存**
   - 在控制台找到"缓存管理"
   - 点击"刷新缓存"或"清除缓存"
   - 选择"全部刷新"

### 方式B：使用 EdgeOne CLI（如果已配置）

```bash
# 进入项目目录
cd trade-platform

# 部署到 EdgeOne Pages
edgeone deploy --dir dist

# 或使用 npm script（如果已配置）
npm run deploy
```

---

## 第3步：验证部署（5分钟）

### 3.1 首页验证（1分钟）

1. 访问：https://www.niuniubase.top
2. 强制刷新：按 `Ctrl + F5`（Windows）或 `Cmd + Shift + R`（Mac）
3. 检查搜索栏下方是否显示板块卡片
4. 应该看到6个板块：
   - 📱 数码电子
   - 🏠 家居生活
   - 👔 服饰鞋包
   - 📚 图书教育
   - 🎮 娱乐休闲
   - 📦 其他分类（876条信息）

**✅ 通过标准**：板块卡片正常显示

### 3.2 板块详情验证（1分钟）

1. 点击"其他分类"板块
2. 检查是否跳转到详情页
3. 检查是否显示876条交易信息
4. 测试搜索功能
5. 点击返回按钮

**✅ 通过标准**：详情页功能正常

### 3.3 发布功能验证（1分钟）

1. 登录测试账号：
   - 手机号：13700000001
   - 密码：test123

2. 点击底部"发布"按钮

3. 检查是否显示"选择板块（可选）"下拉框

4. 测试发布：
   - 标题：测试iPhone 15 Pro
   - 价格：6999
   - 交易类型：出售
   - 板块：选择"数码电子"
   - 点击"确认发布"

**✅ 通过标准**：发布成功，板块选择正常

### 3.4 数据更新验证（1分钟）

1. 返回首页
2. 检查"数码电子"板块的数量
3. 应该从 0 变为 1
4. 点击"数码电子"板块
5. 检查是否显示刚发布的交易信息

**✅ 通过标准**：数据实时更新

### 3.5 管理后台验证（1分钟）

1. 登录管理员账号：
   - 手机号：13011319329
   - 验证码：666666

2. 点击右上角"管理"按钮

3. 检查是否显示"板块管理"标签

4. 点击"板块管理"标签

5. 检查板块列表是否显示

6. 测试编辑功能

**✅ 通过标准**：管理后台功能正常

---

## ✅ 部署完成检查清单

```
部署前：
[x] 数据库已迁移
[x] 代码已开发
[x] 构建已完成

部署中：
[ ] Edge Function 已部署
[ ] 前端已上传
[ ] 缓存已刷新

部署后：
[ ] 首页板块卡片显示 ✅
[ ] 板块详情页正常 ✅
[ ] 发布功能正常 ✅
[ ] 数据更新正常 ✅
[ ] 管理后台正常 ✅
```

---

## 🐛 常见问题

### Q1：部署后首页没有显示板块卡片？
**A1**：
1. 强制刷新浏览器（Ctrl+F5）
2. 清除浏览器缓存
3. 在 EdgeOne 控制台刷新 CDN 缓存
4. 等待5-10分钟让 CDN 生效

### Q2：Edge Function 部署失败？
**A2**：
1. 检查 Supabase CLI 是否已登录
2. 检查访问令牌是否有效
3. 使用 Supabase 控制台手动部署
4. 查看部署日志排查错误

### Q3：发布时没有板块选择？
**A3**：
1. 检查 Edge Function 是否部署成功
2. 检查前端是否部署最新版本
3. 清除浏览器缓存重试
4. 查看浏览器控制台是否有错误

### Q4：板块数量没有自动更新？
**A4**：
1. 检查数据库触发器是否创建成功
2. 刷新页面查看最新数据
3. 在数据库中手动验证 post_count
4. 如需要可以手动执行更新 SQL

---

## 📞 需要帮助？

### 测试账号
```
管理员：13011319329 / 验证码：666666
普通用户：13700000001 / 密码：test123
```

### 相关文档
- 📚 板块功能实施报告.md
- 🧪 板块功能测试指南.md
- ✅ 验证板块功能.md
- 📋 板块功能最终交付清单.md

### 数据库信息
```
项目ID：mgyelmyjeidlvmmmjkqi
URL：https://mgyelmyjeidlvmmmjkqi.supabase.co
```

---

## 🎯 部署成功标志

当您看到以下内容时，说明部署成功：

1. ✅ 首页搜索栏下方显示6个板块卡片
2. ✅ 点击板块可以跳转到详情页
3. ✅ 发布页面有板块选择下拉框
4. ✅ 发布后板块数量自动更新
5. ✅ 管理后台有"板块管理"标签

---

**预计总耗时**：约20分钟  
**难度等级**：⭐⭐（简单）  
**建议**：按顺序执行，逐步验证

**祝部署顺利！** 🎉
